# ==============================
# Profile: test
# Configuración para ENTORNO DE TESTING
# Base de datos H2 en memoria
# ==============================

spring:
  # ------------------------------
  # Configuración JPA / Hibernate
  # ------------------------------
  jpa:
    # En tests no se usa Open Session In View
    open-in-view: false

    # Mostrar SQL ayuda a depurar fallos en tests
    show-sql: true

    hibernate:
      # Hibernate gestiona el esquema automáticamente
      # create-drop asegura un DB limpio por ejecución
      ddl-auto: create-drop

    properties:
      hibernate:
        # Dialecto H2
        dialect: org.hibernate.dialect.H2Dialect

        # SQL legible en consola
        format_sql: true

        # Comentarios útiles en SQL
        use_sql_comments: true

  # ------------------------------
  # Configuración del DataSource
  # ------------------------------
  datasource:
    # H2 en memoria
    # DB_CLOSE_DELAY=-1 mantiene la DB viva durante el contexto
    # MODE=PostgreSQL imita comportamiento de PostgreSQL
    url: jdbc:h2:mem:prediction_test_db;DB_CLOSE_DELAY=-1;MODE=PostgreSQL

    # Credenciales por defecto de H2
    username: sa
    password:

    # Driver JDBC de H2
    driver-class-name: org.h2.Driver

    # ------------------------------
    # Pool de conexiones (HikariCP)
    # ------------------------------
    hikari:
      # Pool pequeño para tests
      pool-name: PredictionConnectionPool-TEST
      maximum-pool-size: 4
      minimum-idle: 1
      connection-timeout: 10000

  # ------------------------------
  # Consola web de H2 (opcional)
  # ------------------------------
  h2:
    console:
      enabled: true
      path: /h2-console

# ------------------------------
# Configuración de logs
# ------------------------------
logging:
  level:
    # SQL generado por Hibernate
    org.hibernate.SQL: DEBUG

    # Parámetros de las queries
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

# ------------------------------
# SpringDoc / Swagger
# ------------------------------
springdoc:
  # En tests no se expone documentación
  swagger-ui:
    enabled: false

  api-docs:
    enabled: false
